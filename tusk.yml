---
name: mycli
usage: A custom aliased command-line application

options:
  build-dir:
    usage: Folder containing Dockerfile

tasks:
  build:
    usage: build docker image
    run: docker build --pull --rm -f "${build-dir}/Dockerfile" -t donaldrich/function:test "${build-dir}"
  dive:
    usage: analyze built image
    run: dive donaldrich/function:test

  prune:
    usage: analyze built image
    run: docker system prune --all --force

  git-hooks:
    usage: hooks
    run:
      - command: pre-commit install
      - command: pre-commit autoupdate
      - command: pre-commit install --hook-type commit-msg
      - command: pre-commit install --hook-type prepare-commit-msg

  # gitleaks:
  #   usage: gitleaks de
  #   run: docker run -it --rm --name=gitleaks -v $PWD:/code zricethezav/gitleaks -v --repo-path=/code

  # gitlab:
  #   usage: gitlab
  #   run: docker run -it --rm -v $PWD:/code donaldrich/function:gitlab-ci-lint /code/.gitlab-ci.yml

  clean:
    usage: template
    run:
      - command: rm -r docs | true
      - command: rm -r .meta/pipelines | true
      - command: mkdir docs
      - command: cp .meta/index.md docs

  template:
    usage: template
    run:
      - command: ./run-all.sh

  regenerate:
    run:
      - task: clean
      - task: template

  pre-commit:
    run:
      - command: pre-commit run -a || true
      - command: pre-commit run -a

  commit:
    run:
      - command: git add .
      - command: 'git commit -m "chore: regenerate templated files"'
      - command: git push origin master

  repo:
    usage: check package versions
    run:
      - command: git pull origin master
      - task: clean
      - task: template
      - task: pre-commit
      - task: commit

  remote:
    usage: check package versions
    run:
      - task: clean
      - task: template
      - task: pre-commit
