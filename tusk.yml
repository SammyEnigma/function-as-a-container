---
name: mycli
usage: A custom aliased command-line application

options:
  build-dir:
    usage: Folder containing Dockerfile

tasks:
  prune:
    usage: analyze built image
    run: docker system prune --all --force

  repo-clean:
    usage: cleans repo
    run:
      - command: rm -r docs | true
      - command: rm -r .meta/pipelines | true
      - command: mkdir docs | true
      - command: cp .meta/docs/index.md docs
      - command: cp .meta/docs/CHANGELOG.md docs

  repo-template:
    usage: applys template
    run:
      - command: ./run-all.sh

  repo-commit:
    run:
      - command: git pull origin master
      - command: pre-commit run -a || true
      - command: git add .
      - command: 'git commit -m "chore(repo): repo"'
      - command: git push origin master

  repo:
    run:
      - task: repo-clean
      - task: repo-template
      - task: repo-commit

  hooks-install:
    usage: hooks
    run:
      - command: pre-commit install
      - command: pre-commit autoupdate --bleeding-edge
      - command: pre-commit install --hook-type commit-msg
      - command: pre-commit install --hook-type prepare-commit-msg
      - command: pre-commit run -a || true

  hooks-list:
    usage: repo-hook-list
    run:
      - command: rm .pre-commit-hooks.yaml | true
      - command: touch .pre-commit-hooks.yaml | true
      - command: pre-commit run --hook-stage manual hook-test -a

  hooks-commit:
    run:
      - command: pre-commit run -a || true
      - command: git add .
      - command: 'git commit -m "docs(hooks): refresh hook list"'
      - command: git push origin master

  hooks-full:
    run:
      - task: hooks-install
      - task: hooks-list
      - task: hooks-commit

  full:
    run:
      - task: repo
      - task: hooks-full
      # - task: update-hooks
      # - task: repo-hook-list
      # - task: commit-to-remote
      # - command: git add .
      # - command: pre-commit autoupdate
      # - command: pre-commit run -a || true

  # pre-commit:
  #   run:
  #     - command: pre-commit run -a || true
  #     - command: pre-commit run -a

  commit-to-remote:
    run:
      - command: git add .
      - command: 'git commit -m "chore: repo"'
      - command: git push origin master

  # repo:
  #   usage: check package versions
  #   run:
  #     - command: git pull origin master
  #     - task: clean
  #     - task: template
  #     - task: pre-commit
  #     - task: commit

  remote:
    usage: check package versions
    run:
      - task: clean
      - task: template
      - task: pre-commit
