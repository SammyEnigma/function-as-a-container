---
name: mycli
usage: A custom aliased command-line application

options:
  build-dir:
    usage: Folder containing Dockerfile

tasks:
  build:
    usage: build docker image
    run: docker build --pull --rm -f "${build-dir}/Dockerfile" -t donaldrich/function:test "${build-dir}"
  dive:
    usage: analyze built image
    run: dive donaldrich/function:test

  prune:
    usage: analyze built image
    run: docker system prune --all --force

  clean-repo:
    usage: cleans repo
    run:
      - command: rm -r docs | true
      - command: rm -r .meta/pipelines | true
      - command: rm hook-test.yaml | true
      - command: mkdir docs | true
      - command: cp .meta/index.md docs
      - command: cp .meta/CHANGELOG.md docs

  apply-template:
    usage: applys template
    run:
      - command: ./run-all.sh

  update-hooks:
    usage: hooks
    run:
      - command: pre-commit install
      # - command: pre-commit autoupdate --bleeding-edge
      - command: pre-commit autoupdate
      - command: pre-commit install --hook-type commit-msg
      - command: pre-commit install --hook-type prepare-commit-msg
      - command: pre-commit run -a || true

  yt-test:
    usage: cleans repo
    run:
      - command: git add .
      - command: pre-commit autoupdate
      - command: rm hook-test.yaml | true
      - command: touch hook-test.yaml | true
      - command: pre-commit run hook-test
      - command: git add .
      - command: pre-commit run identity
  full:
    run:
      - task: clean-repo
      - task: apply-template
      - task: update-hooks
      - task: commit-to-remote
      # - command: git add .
      # - command: pre-commit autoupdate
      # - command: pre-commit run -a || true

  # pre-commit:
  #   run:
  #     - command: pre-commit run -a || true
  #     - command: pre-commit run -a

  commit-to-remote:
    run:
      - command: git add .
      - command: 'git commit -m "chore: repo templates refreshed"'
      - command: git push origin master

  repo:
    usage: check package versions
    run:
      - command: git pull origin master
      - task: clean
      - task: template
      - task: pre-commit
      - task: commit

  remote:
    usage: check package versions
    run:
      - task: clean
      - task: template
      - task: pre-commit
