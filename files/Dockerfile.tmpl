FROM donaldrich/builder:latest AS builder

WORKDIR /data

RUN gget github.com/junegunn/fzf fzf-*-linux_amd64.tar.gz --stdout | tar -xzf- fzf
RUN gget github.com/restic/restic restic_*_linux_amd64.bz2
RUN gget github.com/upx/upx upx-*-amd64_linux.tar.xz --stdout | tar -xJf-
RUN gget github.com/dpb587/gget --executable gget='gget-*-linux-amd64'
RUN gget github.com/mholt/archiver --executable arc='arc_*_linux_amd64'
RUN gget github.com/gruntwork-io/fetch --executable fetch='fetch_linux_amd64'
RUN gget github.com/jesseduffield/horcrux horcrux_*_Linux_x86_64.tar.gz --stdout | tar -xzf- horcrux
RUN gget github.com/whalehub/ginstall.sh --executable ginstall.sh='ginstall.sh'
RUN gget github.com/coord-e/magicpak --executable magicpak='magicpak-x86_64-unknown-linux-musl'
RUN gget github.com/megastep/makeself --executable makeself='makeself-*.run'

FROM ubuntu

RUN apt-get update && apt-get install --no-install-recommends -y curl ncdu tar unzip tree duc ca-certificates \
&& rm -rf /tmp/* /usr/share/doc/* \
  /usr/share/locale/* /usr/share/man/* \
  /var/cache/debconf/* /var/cache/apt/* \
  /var/tmp/* /var/log/* /var/lib/apt/lists/* \
  apt-get autoclean && \
  apt-get autoremove --purge && \
  apt-get clean

COPY --from=builder /data/* /usr/local/bin/
# RUN ginstall.sh --first-run && ginstall.sh --self-update

COPY ./extract.sh /usr/local/bin/extract
# validate
{{- template "validate" }}
